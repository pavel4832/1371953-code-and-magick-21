(()=>{"use strict";window.util={isEscEvent:function(e,t){"Escape"===e.key&&t()},isEnterEvent:function(e,t){"Enter"===e.key&&t()},getRandomNumber:function(e,t){return Math.floor(Math.random()*(t-e))+e},getRandomColor:function(e){return e[Math.floor(e.length*Math.random())]},createErrorMessage:function(e){const t=document.createElement("div");t.style="z-index: 100; margin: 0 auto; text-align: center; background-color: red;",t.style.position="absolute",t.style.left=0,t.style.right=0,t.style.fontSize="30px",t.textContent=e,document.body.insertAdjacentElement("afterbegin",t)}},(()=>{const e=function(e,t,n,o){e.fillStyle=o,e.fillRect(t,n,420,270)};window.renderStatistics=function(t,n,o){e(t,110,20,"rgba(0, 0, 0, 0.7)"),e(t,100,10,"#fff"),t.fillStyle="#000",t.font="16px PT Mono",t.textBaseline="hanging",t.fillText("Ура вы победили!",120,36),t.fillText("Список результатов:",120,52),function(e,t,n){const o=n.reduce((function(e,t){return Math.max(e,t)}),-1/0);for(let r=0;r<t.length;r++){const i=150*n[r]/o,c=Math.floor(parseInt(n[r],10));e.fillStyle="#000",e.fillText(t[r],140+90*r,250),e.fillStyle="Вы"===t[r]?"rgba(255, 0, 0, 1)":"hsl(240, "+window.util.getRandomNumber(0,100)+"%, 50%)",e.fillRect(140+90*r,244-i,40,i),e.fillStyle="#000",e.fillText(String(c),140+90*r,228-i)}}(t,n,o)}})(),window.backend={load:function(e,t){const n=new XMLHttpRequest;n.responseType="json",n.addEventListener("load",(function(){200===n.status?e(n.response):t(`Статус ответа: ${n.status} ${n.statusText}`)})),n.addEventListener("error",(function(){t("Произошла ошибка соединения")})),n.addEventListener("timeout",(function(){t(`Запрос не успел выполниться за ${n.timeout}мс`)})),n.timeout=1e4,n.open("GET","https://21.javascript.pages.academy/code-and-magick/data"),n.send()},upload:function(e,t){const n=new XMLHttpRequest;n.responseType="json",n.addEventListener("load",(function(){t(n.response)})),n.open("POST","https://21.javascript.pages.academy/code-and-magick"),n.send(e)}},window.debounce=function(e){let t=null;return function(...n){let o=n;t&&window.clearTimeout(t),t=window.setTimeout((function(){e(...o)}),500)}},(()=>{const e=document.querySelector(".setup-wizard-appearance");let t={onEyesChange:function(){},onCoatChange:function(){}};window.colorize={setCoatChangeHandler:function(e){t.onCoatChange=e},setEyesChangeHandler:function(e){t.onEyesChange=e},setColor:function(n,o){let r=n.querySelector("input"),i=e.querySelector('input[name="coat-color"]'),c=e.querySelector('input[name="eyes-color"]');n.addEventListener("click",(function(){const e=window.util.getRandomColor(o);"div"===n.tagName.toLowerCase()?(n.style.backgroundColor=e,r.value=e):n.classList.contains("wizard-coat")?(n.style.fill=e,i.value=e,t.onCoatChange(e)):(n.style.fill=e,c.value=e,t.onEyesChange(e))}))}}})(),(()=>{const e=document.querySelector(".setup-wizard-appearance"),t=e.querySelector(".wizard-coat"),n=e.querySelector(".wizard-eyes");window.colorize.setColor(t,["rgb(146, 100, 161)","rgb(215, 210, 55)","rgb(241, 43, 107)","rgb(101, 137, 164)","rgb(0, 0, 0)","rgb(215, 210, 55)","rgb(56, 159, 117)","rgb(241, 43, 107)"]),window.colorize.setColor(n,["red","orange","yellow","green","lightblue","blue","purple"])})(),(()=>{const e=document.querySelector(".setup-similar"),t=document.querySelector(".setup-similar-list"),n=document.querySelector("#similar-wizard-template").content.querySelector(".setup-similar-item"),o=function(e){const t=n.cloneNode(!0);return t.querySelector(".setup-similar-label").textContent=e.name,t.querySelector(".wizard-coat").style.fill=e.colorCoat,t.querySelector(".wizard-eyes").style.fill=e.colorEyes,t};window.render=function(n){let r=n.length>4?4:n.length;t.innerHTML="";for(let e=0;e<r;e++)t.appendChild(o(n[e]));e.classList.remove("hidden")}})(),(()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector(".upload input[type=file]"),n=document.querySelector(".setup-user-pic");t.addEventListener("change",(function(){const o=t.files[0],r=o.name.toLowerCase();if(e.some((function(e){return r.endsWith(e)}))){const e=new FileReader;e.addEventListener("load",(function(){n.src=e.result})),e.readAsDataURL(o)}}))})(),(()=>{const e=document.querySelector(".setup-fireball-wrap");let t=[],n="rgb(101, 137, 164)",o="black";const r=function(e){let t=0;return e.colorCoat===n&&(t+=2),e.colorEyes===o&&(t+=1),t},i=function(){window.render(t.sort((function(e,t){let n=r(t)-r(e);return 0===n&&(n=function(e,t){return e>t?1:e<t?-1:0}(e.name,t.name)),n})))};window.colorize.setEyesChangeHandler(window.debounce((function(e){o=e,i()}))),window.colorize.setCoatChangeHandler(window.debounce((function(e){n=e,i()}))),window.colorize.setColor(e,["#ee4830","#30a8ee","#5ce6c0","#e848d5","#e6e848"]),window.backend.load((function(e){t=e,i()}),(function(e){window.util.createErrorMessage(e)}))})(),(()=>{const e=document.querySelector(".setup"),t=e.querySelector(".upload"),n=document.querySelector(".setup-open"),o=document.querySelector(".setup-close"),r=document.querySelector(".setup-wizard-form"),i=document.querySelector(".setup-user-name"),c=function(e){i!==document.activeElement&&window.util.isEscEvent(e,s)},l=function(){e.classList.remove("hidden"),document.addEventListener("keydown",c)},s=function(){e.classList.add("hidden"),e.style.top="80px",e.style.left="50%",document.removeEventListener("keydown",c)};n.addEventListener("click",l),n.addEventListener("keydown",(function(e){window.util.isEnterEvent(e,l)})),o.addEventListener("click",s),o.addEventListener("keydown",(function(e){window.util.isEnterEvent(e,s)})),t.addEventListener("mousedown",(function(n){n.preventDefault();let o={x:n.clientX,y:n.clientY},r=!1;const i=function(t){t.preventDefault();let n=o.x-t.clientX,i=o.y-t.clientY;r=!0,o={x:t.clientX,y:t.clientY},e.style.top=e.offsetTop-i+"px",e.style.left=e.offsetLeft-n+"px"},c=function(e){if(e.preventDefault(),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",c),r){const e=function(n){n.preventDefault(),t.removeEventListener("click",e)};t.addEventListener("click",e)}};document.addEventListener("mousemove",i),document.addEventListener("mouseup",c)})),r.addEventListener("submit",(function(t){window.backend.upload(new FormData(r),(function(){e.classList.add("hidden")})),t.preventDefault()}))})()})();